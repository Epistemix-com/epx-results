"""
Fixtures for tests in ``./epxresults``
"""

from pathlib import Path
import os
import pytest

ROOT_DIR = Path(os.path.abspath(__file__)).parent.parent
DATA_GENERATION_SCRIPT = 'scripts/generate-test-data.py'


def fred_results() -> str:
    """
    Path to testing data results directory.

    These results are generated by running
    python <project-root>/scripts/generate-test-data.py
    """
    p = Path(os.path.abspath(os.path.join(ROOT_DIR, 'tests/fred-results')))
    if not p.is_dir():
        raise ValueError(f'{p} does not exist. Make sure you have run '
                         f'`{DATA_GENERATION_SCRIPT}`')
    if len(list(p.iterdir())) == 0:
        raise ValueError(f'{p} is empty. Make sure you have run '
                         f'`{DATA_GENERATION_SCRIPT}`')
    return str(p)


@pytest.fixture
def pkg_test_env(monkeypatch):
    monkeypatch.setenv("FRED_RESULTS", fred_results())
